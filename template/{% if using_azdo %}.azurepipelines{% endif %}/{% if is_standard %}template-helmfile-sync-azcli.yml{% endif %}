steps:
  - checkout: self
    displayName: Checkout Repo Files
  - bash: |
      curl https://mise.run | sh
      echo "##vso[task.prependpath]$(HOME)/.local/bin"
      echo "##vso[task.prependpath]$(HOME)/.local/share/mise/bin"
      echo "##vso[task.prependpath]$(HOME)/.local/share/mise/shims"
    displayName: Mise Install
  - bash: mise install
    displayName: Mise Tool Install
  - task: AzureCLI@2
    displayName: Helmfile Sync
    inputs:
      azureSubscription: ${{ parameters.ServiceConnection }}
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: mise x -- helmfile sync --file src/helmfile.yaml.gotmpl --environment "$(HelmfileEnvironment)"
      visibleAzLogin: false
